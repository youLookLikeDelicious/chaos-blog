---
author: "ä½ å¥½åƒå¾ˆå¥½åƒ"
title: "Flutter Widget"
date: "2025-11-11"
summary: "Flutterä¸‡ç‰©çš†ç»„ä»¶, æ— è®ºæ˜¯æ–‡æœ¬ã€æŒ‰é’®ã€å›¾ç‰‡ã€å¸ƒå±€ã€åŠ¨ç”»è¿˜æ˜¯äº¤äº’é€»è¾‘ï¼Œ éƒ½ç”±widegå®ç°. Flutter çš„æ•´ä¸ª UI æ ‘æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”± Widget åµŒå¥—ç»„æˆçš„ Widgetæ ‘."
tags: ["Flutter"]
series: ["Flutter"]
ShowToc: true
weight: 1
TocOpen: true
---

# ğŸ³Flutterä¸‡ç‰©çš†ç»„ä»¶
æ— è®ºæ˜¯æ–‡æœ¬ã€æŒ‰é’®ã€å›¾ç‰‡ã€å¸ƒå±€ã€åŠ¨ç”»è¿˜æ˜¯äº¤äº’é€»è¾‘ï¼Œ éƒ½ç”±widegå®ç°. Flutter çš„æ•´ä¸ª UI æ ‘æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”± Widget åµŒå¥—ç»„æˆçš„ **Widgetæ ‘.** 
## Widgetç‰¹æ€§
1. **ä¸å¯å˜æ€§(immutable)**: æ‰€æœ‰ Widget éƒ½æ˜¯ä¸å¯å˜çš„ï¼ˆå±æ€§ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹ï¼‰ã€‚å½“ UI éœ€è¦æ›´æ–°æ—¶ï¼ˆæ¯”å¦‚çŠ¶æ€å˜åŒ–ï¼‰ï¼Œåªèƒ½ **åˆ›å»ºä¸€ä¸ªæ–°çš„ Widget æ›¿æ¢å®ƒ**ã€‚
2. **ç»„åˆä¼˜äºç»§æ‰¿: **Flutter ä¸é¼“åŠ±é€šè¿‡ç»§æ‰¿æ‰©å±• Widget åŠŸèƒ½ï¼Œè€Œæ˜¯é€šè¿‡**ç»„åˆ**ï¼ˆå°†å¤šä¸ªç®€å• Widget åµŒå¥—ç»„åˆï¼‰å®ç°å¤æ‚ UIã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª â€œå¸¦é˜´å½±çš„çº¢è‰²æŒ‰é’®â€ å¯ä»¥é€šè¿‡ Containerï¼ˆè®¾ç½®é˜´å½±å’Œé¢œè‰²ï¼‰åŒ…è£¹ ElevatedButton å®ç°ï¼Œè€Œéç»§æ‰¿ ElevatedButton é‡å†™æ ·å¼ã€‚
3. **æ—¢æ˜¯æè¿°ä¹Ÿæ˜¯é…ç½®: **Widget ä¸ä»…æè¿° â€œUI é•¿ä»€ä¹ˆæ ·â€ï¼Œè¿˜åŒ…å«äº†å¸ƒå±€è§„åˆ™ã€äº¤äº’é€»è¾‘ã€ä¸»é¢˜æ ·å¼ç­‰é…ç½®ä¿¡æ¯ã€‚ä½† Widget æœ¬èº«ä¸ç›´æ¥è´Ÿè´£æ¸²æŸ“ï¼Œå®ƒæ›´åƒä¸€ä»½ â€œè“å›¾â€ï¼Œç”± Flutter å¼•æ“é€šè¿‡ Element å’Œ RenderObject å®Œæˆå®é™…æ¸²æŸ“ï¼ˆåé¢ä¼šç®€å•è¯´æ˜ä¸‰è€…å…³ç³»ï¼‰ã€‚

## ğŸ¤”ä¸ºä»€ä¹ˆ Flutter è¦è®¾è®¡æˆâ€œä¸å¯å˜(immutable)â€
è¿™å’Œ Flutter çš„æ¸²æŸ“æœºåˆ¶æœ‰å…³ã€‚Flutter çš„ UI æ¸²æŸ“æœ¬è´¨æ˜¯ â€œé€šè¿‡å¯¹æ¯”æ–°æ—§ Widget æ ‘ï¼Œè®¡ç®—å‡ºæœ€å°æ›´æ–°èŒƒå›´â€ çš„è¿‡ç¨‹ï¼ˆç±»ä¼¼ React çš„è™šæ‹Ÿ DOM diffï¼‰ã€‚
Flutter çš„ç•Œé¢æ›´æ–°è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š
1. æ¯æ¬¡çŠ¶æ€å˜åŒ–æ—¶ï¼ˆæ¯”å¦‚ setState() è°ƒç”¨åï¼‰ï¼ŒFlutter ä¼šé‡æ–°è°ƒç”¨ build()ï¼›
2. build() ä¼šè¿”å›**æ–°çš„ Widget æ ‘**ï¼›
3. Flutter æ¯”è¾ƒâ€œæ—§æ ‘â€å’Œâ€œæ–°æ ‘â€ï¼Œåˆ¤æ–­å“ªäº›èŠ‚ç‚¹å˜äº†ï¼›
4. åªæ›´æ–°å˜åŠ¨çš„éƒ¨åˆ†ï¼Œé‡æ–°æ¸²æŸ“ç•Œé¢ã€‚
## Widget æ ‘: UI çš„è“å›¾
æƒ³è±¡ä¸€ä¸‹ï¼š
- **Widget** åƒä¸€å¼ æˆ¿å­çš„è“å›¾ï¼›
- **Element** æ˜¯å»ºç­‘å·¥äººï¼›
- **RenderObject** æ˜¯å®é™…ç›–å‡ºæ¥çš„æˆ¿å­ã€‚
å½“ä½ æƒ³æ¢ä¸€ä¸ªçª—æˆ·é¢œè‰²ï¼ˆæ¯”å¦‚æ–‡å­—ä»â€œHelloâ€æ”¹ä¸ºâ€œHiâ€ï¼‰æ—¶ï¼Œ
 Flutter ä¼šï¼š
- ç”Ÿæˆä¸€å¼ æ–°çš„è“å›¾ï¼ˆæ–°çš„ Widgetï¼‰ï¼›
- å·¥äººï¼ˆElementï¼‰æ‹¿åˆ°æ–°è“å›¾ï¼Œåªåœ¨å¿…è¦çš„åœ°æ–¹ä¿®æ”¹æˆ¿å­ï¼ˆRenderObjectï¼‰ã€‚
è¿™æ ·åšå¯ä»¥ï¼š
- ä¿æŒé€»è¾‘ç®€å•ï¼›
- é¿å…ç›´æ¥æ“ä½œç•Œé¢å¯¼è‡´çš„æ··ä¹±ï¼›
- è®©ç•Œé¢æ›´æ–°æ›´é«˜æ•ˆã€‚
## Element æ ‘: Render Objectå’ŒWidgetä¹‹é—´çš„æ¡¥æ¢
æ¯ä¸ª Widget åœ¨ç•Œé¢ä¸­è¢«æ’å…¥æ—¶ï¼Œéƒ½ä¼šå¯¹åº”ä¸€ä¸ª Element, Elementæ˜¯å¯å˜çš„ã€‚
### å®ƒçš„ä¸»è¦èŒè´£åŒ…æ‹¬
|     |    |
| ---- |---- |
|**åŠŸèƒ½**|**è¯´æ˜**|
|  æŒæœ‰ Widget çš„å®ä¾‹  |æ¯ä¸ª Widget éƒ½æœ‰å¯¹åº”çš„ Element|
|  ç»´æŠ¤çˆ¶å­å±‚çº§ç»“æ„  |å½¢æˆ **Element Tree**ï¼ˆè¿è¡Œæ—¶çœŸæ­£çš„ UI æ ‘ï¼‰|
|  ç®¡ç†ç”Ÿå‘½å‘¨æœŸ  |æ§åˆ¶ build / update / remove|
|  æŒæœ‰æ¸²æŸ“å¯¹è±¡å¼•ç”¨  |å¦‚æœ Widget éœ€è¦ç»˜åˆ¶ï¼Œä¼šæŒæœ‰ RenderObject.|

### ğŸ’¡ å…¸å‹çš„ â€œæ—  RenderObject çš„ Widgetâ€ ç±»åˆ«
1. ç”¨äºç»„åˆ / ç®¡ç†å­ Widget çš„å®¹å™¨ç±» Widget
è¿™ç±» Widget æœ¬èº«ä¸å‚ä¸æ¸²æŸ“ï¼Œä»…è´Ÿè´£ç»„ç»‡å­ Widget çš„ç»“æ„æˆ–é€»è¾‘ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯ â€œç»„åˆâ€ è€Œé â€œç»˜åˆ¶â€ã€‚
- **StatelessWidget**** å’Œ ****StatefulWidget**** çš„è‡ªå®šä¹‰å­ç±»**ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯ç»„åˆå…¶ä»– Widgetï¼ˆå¦‚ Columnã€Textã€Button ç­‰ï¼‰ï¼Œè‡ªèº«å¹¶ä¸éœ€è¦æ¸²æŸ“ã€‚
1. ç”¨äºä¼ é€’æ•°æ®çš„ InheritedWidget åŠå…¶å­ç±»
InheritedWidget çš„æ ¸å¿ƒä½œç”¨æ˜¯**åœ¨ Widget æ ‘ä¸­å…±äº«æ•°æ®**ï¼ˆå¦‚ä¸»é¢˜ã€è®¾å¤‡ä¿¡æ¯ç­‰ï¼‰ï¼Œå®ƒä¸å‚ä¸å¸ƒå±€æˆ–ç»˜åˆ¶ï¼Œå› æ­¤æ²¡æœ‰å¯¹åº”çš„ RenderObjectã€‚
- å…¸å‹ç¤ºä¾‹ï¼š
- Themeï¼šä¼ é€’åº”ç”¨ä¸»é¢˜ï¼ˆé¢œè‰²ã€å­—ä½“ç­‰ï¼‰ï¼Œè‡ªèº«ä¸æ¸²æŸ“ã€‚
- MediaQueryï¼šä¼ é€’è®¾å¤‡å°ºå¯¸ã€æ–¹å‘ç­‰ä¿¡æ¯ï¼Œè‡ªèº«ä¸æ¸²æŸ“ã€‚
- Localizationsï¼šä¼ é€’å¤šè¯­è¨€æ–‡æœ¬ï¼Œè‡ªèº«ä¸æ¸²æŸ“ã€‚
- è¿™äº› Widget é€šè¿‡ InheritedElement ç®¡ç†æ•°æ®ä¼ é€’ï¼ŒInheritedElement ä¸ä¼šåˆ›å»º RenderObjectï¼Œä»…è´Ÿè´£è®©å­ Widget å¯ä»¥ â€œä¾èµ–â€ å¹¶è·å–æ•°æ®ã€‚
1. ç”¨äºé…ç½®çˆ¶èŠ‚ç‚¹å¸ƒå±€é€»è¾‘çš„ ParentDataWidget å­ç±»
ParentDataWidget çš„ä½œç”¨æ˜¯**å‘çˆ¶ Widget çš„å¸ƒå±€é€»è¾‘ä¼ é€’é…ç½®ä¿¡æ¯**ï¼ˆå¦‚å­ Widget åœ¨çˆ¶å®¹å™¨ä¸­çš„ä½ç½®ã€å°ºå¯¸çº¦æŸç­‰ï¼‰ï¼Œè‡ªèº«ä¸å‚ä¸æ¸²æŸ“ã€‚
- å…¸å‹ç¤ºä¾‹ï¼š
- Positionedï¼ˆé…åˆ Stack ä½¿ç”¨ï¼‰ï¼šæŒ‡å®šå­ Widget åœ¨ Stack ä¸­çš„ä½ç½®ï¼ˆleft/top/right/bottomï¼‰ï¼Œä½† Positioned æœ¬èº«ä¸æ¸²æŸ“ï¼Œä»…å°†ä½ç½®ä¿¡æ¯ä¼ é€’ç»™ Stack çš„ RenderObjectï¼ˆRenderStackï¼‰ã€‚
- Flexible/Expandedï¼ˆé…åˆ Row/Column ä½¿ç”¨ï¼‰ï¼šæŒ‡å®šå­ Widget åœ¨å¼¹æ€§å¸ƒå±€ä¸­çš„å æ¯”ï¼Œè‡ªèº«ä¸æ¸²æŸ“ï¼Œä»…å°†å¼¹æ€§ç³»æ•°ä¼ é€’ç»™ Row/Column çš„ RenderObjectï¼ˆRenderFlexï¼‰ã€‚
1. ç”¨äºæ„å»ºé€»è¾‘çš„è¾…åŠ© Widget
éƒ¨åˆ† Widget ä»…ç”¨äºå°è£… â€œæ„å»ºé€»è¾‘â€ï¼ˆå¦‚æ¡ä»¶æ¸²æŸ“ã€åŠ¨æ€ç”Ÿæˆå­ Widgetï¼‰ï¼Œè‡ªèº«ä¸å‚ä¸æ¸²æŸ“ã€‚
- å…¸å‹ç¤ºä¾‹ï¼š
- Builderï¼šä»…æ¥æ”¶ä¸€ä¸ª builder å‡½æ•°å¹¶è¿”å›å­ Widgetï¼Œç”¨äºåœ¨æ„å»ºæ—¶è·å– BuildContextï¼Œè‡ªèº«æ—  RenderObjectã€‚
- StatefulBuilderï¼šç±»ä¼¼ Builderï¼Œä½†æ”¯æŒåœ¨æ„å»ºæ—¶ç®¡ç†ä¸´æ—¶çŠ¶æ€ï¼Œè‡ªèº«ä¸æ¸²æŸ“ã€‚
æ ¸å¿ƒåŸå› ï¼šèŒè´£åˆ†ç¦»
Flutter è®¾è®¡ä¸­ï¼ŒRenderObject çš„æ ¸å¿ƒèŒè´£æ˜¯**å¸ƒå±€ã€ç»˜åˆ¶ã€å‘½ä¸­æµ‹è¯•**ï¼ˆç›´æ¥ä¸æ¸²æŸ“ç›¸å…³ï¼‰ã€‚è€Œä¸Šè¿° Widget çš„èŒè´£æ˜¯**ç»„åˆã€ç®¡ç†ã€ä¼ é€’æ•°æ®**ï¼Œè¿™äº›å·¥ä½œä¸éœ€è¦å‚ä¸åº•å±‚æ¸²æŸ“ï¼Œå› æ­¤æ— éœ€åˆ›å»º RenderObjectã€‚
é€šè¿‡è¿™ç§è®¾è®¡ï¼ŒFlutter ç¡®ä¿äº† â€œæ¸²æŸ“æ ‘ï¼ˆRenderObject æ ‘ï¼‰â€ åªåŒ…å«å¿…è¦çš„æ¸²æŸ“èŠ‚ç‚¹ï¼Œé¿å…äº†å†—ä½™è®¡ç®—ï¼Œæå‡äº†æ€§èƒ½ã€‚


## Render Objectæ ‘: æ¸²æŸ“çš„åŸåŠ¨åŠ›
RenderObject æ˜¯çœŸæ­£ **æ‰§è¡Œå¸ƒå±€ã€ç»˜åˆ¶ã€å‘½ä¸­æµ‹è¯•ï¼ˆç‚¹å‡»æ£€æµ‹ï¼‰** çš„å¯¹è±¡, å®ƒæ˜¯å¯å˜çš„ã€‚å®ƒæ„æˆäº† Flutter çš„åº•å±‚æ¸²æŸ“æ ‘ï¼ˆRender Treeï¼‰ã€‚
### ä»–çš„ä¸»è¦èŒè´£åŒ…æ‹¬
|     |    |
| ---- |---- |
|åŠŸèƒ½|è¯´æ˜|
|  å¸ƒå±€ï¼ˆlayoutï¼‰  |æµ‹é‡å­èŠ‚ç‚¹å¤§å°ã€ç¡®å®šè‡ªå·±ä½ç½®|
|  ç»˜åˆ¶ï¼ˆpaintï¼‰  |ç»˜åˆ¶åˆ°å±å¹•çš„ Canvas ä¸Š|
|  å‘½ä¸­æµ‹è¯•ï¼ˆhitTestï¼‰  |åˆ¤æ–­ç‚¹å‡»äº‹ä»¶æ˜¯å¦è½åœ¨è‡ªå·±èŒƒå›´å†…|
|  æ€§èƒ½ä¼˜åŒ–  |Flutter ä¼šå¤ç”¨ RenderObject ä»¥é¿å…é‡å¤æ„å»º|

Widget Tree Element treeå’ŒRenderObject treeå…³ç³»å›¾
![image](images/BoNNbCsoqouKXGxq4syc0X64nEc)

## ğŸ§Flutteræ˜¯å¦‚ä½•å¤ç”¨Elementå’ŒRenderObject
å¾ˆå¤šäººçŸ¥é“ Flutter æ¯æ¬¡ setState éƒ½ä¼šé‡å»º Widgetï¼Œä½†å…¶å®çœŸæ­£**ä¸ä¼šé¢‘ç¹é‡å»ºçš„æ˜¯ Element å’Œ RenderObject**ã€‚

å½“ setState() è¢«è°ƒç”¨æ—¶ï¼ŒFlutter ä¼šï¼š
1. **é‡æ–°åˆ›å»ºæ–°çš„ Widget æ ‘**ï¼›
2. ä¸æ—§çš„ Widget æ ‘ **å¯¹æ¯”ï¼ˆdiffï¼‰**ï¼›
3. å¦‚æœç±»å‹æˆ–keyç›¸åŒï¼Œåˆ™å¤ç”¨å¯¹åº”çš„ Element å’Œ RenderObjectï¼›
4. ä»…æ›´æ–°éœ€è¦å˜åŠ¨çš„å±æ€§ï¼›
5. é¿å…æ•´ä¸ªç•Œé¢é‡ç»˜ã€‚
#### Element å±‚å¤ç”¨
Flutter çš„ Element æ ‘æ˜¯çœŸæ­£æŒä¹…å­˜åœ¨çš„å¯¹è±¡æ ‘ã€‚
å½“ Flutter é‡æ–°æ„å»ºæ—¶ï¼Œä¼šè°ƒç”¨ï¼š
Element.update(newWidget)
åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼š
1. åˆ¤æ–­æ–°æ—§ Widget ç±»å‹æ˜¯å¦ç›¸åŒï¼›
2. å¦‚æœç›¸åŒï¼š
- ä¿ç•™å½“å‰ Elementï¼›
- æ›´æ–°å…¶ä¸­ä¿å­˜çš„ Widget å¼•ç”¨ï¼›
- è°ƒç”¨ widget.updateRenderObject(context, renderObject) æ¥åŒæ­¥å±æ€§ï¼›
1. å¦‚æœç±»å‹ä¸åŒï¼š
- é”€æ¯æ—§ Elementï¼›
- åˆ›å»ºæ–°çš„ Elementï¼ˆå’Œå¯¹åº” RenderObjectï¼‰ã€‚
ä¸¾ä¾‹è¯´æ˜
```Dart
Text('Count: 1');
// å˜æˆ
Text('Count: 2');
```
Flutter æ£€æŸ¥ï¼š
- æ–°æ—§ Widget ç±»å‹éƒ½ä¸º Text âœ…
- æ—§çš„ Element å¯å¤ç”¨ âœ…
- è°ƒç”¨ update() æ›´æ–°æ–‡å­—å†…å®¹
- åº•å±‚ RenderParagraphï¼ˆRenderObjectï¼‰ç»§ç»­å¤ç”¨ï¼Œåªé‡æ–°ç»˜åˆ¶æ–‡å­—
 æ‰€ä»¥è™½ç„¶ä½ æ¯æ¬¡éƒ½åœ¨ â€œbuild()â€ æ–° Widgetï¼Œå®é™…ä¸Šåº•å±‚å¯¹è±¡å’Œç»˜åˆ¶æ€§èƒ½å‡ ä¹æ²¡å˜ã€‚
#### RenderObjectå±‚å¤ç”¨
åœ¨ RenderObjectWidgetï¼ˆå¦‚ Container, Text, Imageï¼‰ä¸­ï¼Œ
 æ¯ä¸ª Widget éƒ½ä¼šå¯¹åº”ä¸€ä¸ª RenderObjectã€‚
å½“ Element åˆ¤æ–­å¯ä»¥å¤ç”¨æ—¶ï¼Œä¼šæ‰§è¡Œï¼š
widget.updateRenderObject(context, renderObject);
è¿™ä¸ªæ–¹æ³•å†…éƒ¨åªæ›´æ–°å±æ€§ï¼Œä¸ä¼šé‡æ–°åˆ›å»ºå¯¹è±¡ã€‚
 ä¾‹å¦‚ RenderParagraphï¼š
```Dart
@override
void updateRenderObject(BuildContext context, RenderParagraph renderObject) {
  renderObject
    ..text = textSpan
    ..textAlign = textAlign
    ..maxLines = maxLines;
}
```
è¿™æ„å‘³ç€ï¼š
- åŒä¸€ä¸ª RenderObject å®ä¾‹ç»§ç»­å­˜åœ¨ï¼›
- åªä¿®æ”¹å˜åŠ¨çš„å±æ€§ï¼›
- å¸ƒå±€ç³»ç»Ÿåªé‡æ–°è®¡ç®—å±€éƒ¨å˜åŒ–ï¼›
- æ¸²æŸ“å±‚åªé‡ç»˜å¿…è¦åŒºåŸŸã€‚
#### æ€»ç»“
|     |    |
| ---- |---- |
|ç‰¹æ€§|è¯´æ˜|
|  **Widget å¯é‡å»ºä½†è½»é‡**  |åªæ˜¯é…ç½®æè¿°ï¼Œåˆ›å»ºæˆæœ¬ä½|
|  **Element å¯å¤ç”¨**  |é¿å…é¢‘ç¹åˆ›å»ºå¯¹è±¡æ ‘|
|  **RenderObject å±€éƒ¨æ›´æ–°**  |åªé‡ç»˜å˜åŒ–éƒ¨åˆ†ï¼ŒèŠ‚çœ GPU/CPU|
|  **å…¨æ ‘ Diff ä¼˜åŒ–**  |Flutter é€šè¿‡ O(N) ç®—æ³•æ¯”è¾ƒæ ‘ç»“æ„ï¼Œé¿å…æ˜‚è´µçš„è™šæ‹Ÿ DOM å¯¹æ¯”|



References:
How Flutter Renders Widgets: A Tale of Widgets, Elements, and Render Objects
Understanding Keys, Elements, RenderObjects and their interplay in Flutter

